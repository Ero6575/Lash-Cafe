<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard — Lash Menu</title>
    <link rel="stylesheet" href="../style.css">
</head>

<body class="admin">
    <div class="layout">
        <aside class="sidebar">
            <div class="logo">Lash Admin</div>
            <nav>
                <button id="nav-items" class="active">Menu Items</button>
                <button id="nav-categories">Categories</button>
            </nav>
            <div class="sidebar-foot">
                <button id="signout">Sign Out</button>
            </div>
        </aside>

        <main class="main">
            <header class="topbar">
                <div class="topbar-left">
                    <h1 id="page-title">Menu Items</h1>
                </div>
                <div class="top-actions">
                    <input id="global-search" class="input" placeholder="Search items">
                    <button id="import-menu-json" class="btn">Import</button>
                    <button id="new-item" class="btn btn-edit">Add Item</button>
                    <button id="signout-top" class="btn">Sign Out</button>
                </div>
            </header>

            <section id="content-area">
                <div id="loading" class="loading">Loading...</div>

                <!-- Category cards grid (default Menu Items view) -->
                <div id="category-cards-view" class="hidden">
                    <div id="category-cards-grid" class="category-cards-grid"></div>
                </div>

                <!-- Items list within a selected category -->
                <div id="category-items-view" class="hidden">
                    <div class="items-header">
                        <button id="back-to-categories" class="btn">← Back</button>
                        <h2 id="items-view-title">Category Items</h2>
                    </div>
                    <div id="items-list" class="items-grid"></div>
                </div>

                <!-- Category management view -->
                <div id="categories-view" class="card hidden">
                    <div class="category-controls">
                        <input id="new-category-name" placeholder="New category name">
                        <button id="add-category" class="btn btn-edit">Add</button>
                    </div>
                    <ul id="categories-list"></ul>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal: Add/Edit Item -->
    <div id="item-modal" class="modal slide-over">
        <div class="modal-inner slide-inner">
            <h3 id="item-modal-title">New Item</h3>
            <form id="item-form">
                <div class="form-row">
                    <div class="field">
                        <label class="field-label" for="item-name-en">Name (English)</label>
                        <input id="item-name-en" type="text" required>
                    </div>
                    <div class="field">
                        <label class="field-label" for="item-name-am">Name (Amharic)</label>
                        <input id="item-name-am" type="text">
                    </div>
                    <div class="field">
                        <label class="field-label" for="item-name-om">Name (Afaan Oromo)</label>
                        <input id="item-name-om" type="text">
                    </div>
                </div>

                <div class="form-row">
                    <div class="field">
                        <label class="field-label" for="item-ingredients-en">Ingredients (English)</label>
                        <input id="item-ingredients-en" placeholder="e.g. Beef patty, Lettuce, Tomato">
                    </div>
                    <div class="field">
                        <label class="field-label" for="item-ingredients-am">Ingredients (Amharic)</label>
                        <input id="item-ingredients-am">
                    </div>
                    <div class="field">
                        <label class="field-label" for="item-ingredients-om">Ingredients (Afaan Oromo)</label>
                        <input id="item-ingredients-om">
                    </div>
                </div>

                <div class="form-row">
                    <div class="field">
                        <label class="field-label" for="item-price">Price</label>
                        <input id="item-price" type="number" min="0" step="1">
                    </div>
                    <div class="field">
                        <label class="field-label" for="item-category">Category</label>
                        <select id="item-category" required></select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="field">
                        <label class="field-label" for="item-image-file">Image file</label>
                        <input id="item-image-file" type="file" accept="image/*">
                    </div>
                    <div class="field">
                        <label class="field-label" for="item-image-url">Image URL</label>
                        <input id="item-image-url" type="text" placeholder="Or paste image URL (absolute or relative)">
                    </div>
                </div>

                <div id="item-image-preview-wrap" class="image-preview">
                    <label class="field-label">Preview</label>
                    <img id="item-image-preview" src="" alt="preview">
                </div>

                <div class="modal-actions">
                    <button type="button" id="item-cancel" class="btn">Cancel</button>
                    <button type="submit" id="item-save" class="btn btn-edit">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirm delete -->
    <div id="confirm-modal" class="modal">
        <div class="modal-inner">
            <p id="confirm-text">Are you sure?</p>
            <div class="modal-actions">
                <button id="confirm-no">No</button>
                <button id="confirm-yes">Yes</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>

    <!-- Busy overlay to prevent flicker during loads -->
    <div id="busy-overlay" class="busy-overlay" aria-hidden="true">
        <div class="busy-inner">
            <div class="spinner" aria-hidden="true"></div>
            <div class="busy-text">Loading…</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/dashboard.js"></script>
    <script>
        // Minimal config check: silently redirect to login if supabase config missing
        (function () {
            try {
                if (!window.SUPABASE_URL || !window.SUPABASE_ANON_KEY) { location.href = 'login.html'; }
            } catch (e) { /* ignore */ }
        })();
    </script>
    <!-- Removed service worker unregistration to avoid race conditions and flicker -->
</body>

</html>